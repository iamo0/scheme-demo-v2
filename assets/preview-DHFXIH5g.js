import{r as s,j as e,c as O}from"./client-CGKsYi93.js";import{R as w,S as D,i as I,h as V,j as A}from"./useScheme-CDG04uM4.js";const N="1";function B({canvas:c}){const[n]=s.useContext(w),d=s.useContext(D),[l]=d.hallData,[h]=d.priceSchemes,[p]=d.sectionsPrices,u=h[N],m=p[N],[a,g]=s.useState(localStorage.getItem("cart")?JSON.parse(localStorage.getItem("cart")):[]),[r,f]=s.useState(null);I(h,p,N,c),s.useEffect(function(){var P,E,v;n.seats.forEach((S,i)=>{i.selectable=!0,i.setControlsVisibility({delete:!1})});const x=()=>{f(null)},C=()=>{var i,j;const S=(i=c.current)==null?void 0:i.getActiveObject();if(((j=c.current)==null?void 0:j.getActiveObject())instanceof V){f(S);return}f(null)};return(P=c.current)==null||P.on("selection:created",C),(E=c.current)==null||E.on("selection:updated",C),(v=c.current)==null||v.on("selection:cleared",x),function(){var S,i,j;n.seats.forEach((F,R)=>{R.selectable=!1,R.setControlsVisibility({delete:!0})}),(S=c.current)==null||S.off("selection:created",C),(i=c.current)==null||i.off("selection:updated",C),(j=c.current)==null||j.off("selection:cleared",x)}},[n]);const b=t=>{localStorage.setItem("cart",JSON.stringify(a)),g([...a,t])},o=t=>{localStorage.setItem("cart",JSON.stringify(a)),g(a.filter(x=>x!==t))},y=t=>{a.includes(t)?o(t):b(t)};return e.jsxs(e.Fragment,{children:[r!==null?e.jsxs("div",{className:"active-seat-popup",style:{left:r.getBoundingRect().left+r.getBoundingRect().width/2,top:r.getBoundingRect().top},children:[e.jsxs("span",{className:"active-seat-popup-price",children:[u.groups[m.seats[n.seats.get(r)]].price,"₽"]}),"Ряд ",l.rows[l.seats[n.seats.get(r)].row].number,", Место ",l.seats[n.seats.get(r)].number,e.jsx("div",{className:"active-seat-popup-controls",children:e.jsx("button",{onClick:()=>y(n.seats.get(r)),className:"active-seat-popup-control-add",children:a.includes(n.seats.get(r))?"Удалить из корзины":"Добавить в корзину"})})]}):null,e.jsxs("div",{className:"cart",children:[a.map(t=>e.jsxs("div",{className:"cart-item",children:[e.jsxs("div",{className:"cart-item-price",style:{color:u.groups[m.seats[t]].color},children:[u.groups[m.seats[t]].price,"₽"]}),"Ряд ",l.rows[l.seats[t].row].number,", Место ",l.seats[t].number]},`seat-${t}`)),a.length>0?e.jsx("button",{className:"cart-pay",children:"Перейти к оплате"}):null]})]})}function _(){const c=s.useRef(null),[n,d]=s.useState(!0),[l,h]=s.useState({}),[p,u]=s.useState({}),[m,a]=s.useState({}),[g,r]=s.useState({}),f={hallData:[l,h],hallVisualData:[p,u],priceSchemes:[m,a],sectionsPrices:[g,r]};return s.useEffect(function(){n!==!1&&Promise.all([fetch("/json/hall.json"),fetch("/json/hallVisual.json"),fetch("/json/priceSchemes.json"),fetch("/json/sectionsPrices.json")]).then(o=>Promise.all([o[0].json(),o[1].json(),o[2].json(),o[3].json()])).then(o=>{h(o[0]),u(o[1]),a(o[2]),r(o[3]),d(!1)})},[n]),n?e.jsx("div",{className:"preloader",children:"Загружается список событий…"}):e.jsx(e.Fragment,{children:e.jsxs("main",{className:"scheme",children:[e.jsx("a",{href:"/",className:"exit",children:"Назад"}),e.jsx("div",{className:"scheme-name-container",ref:c}),e.jsx(A,{scheme:f,nameContainer:c,children:e.jsx(B,{})})]})})}O.createRoot(document.getElementById("root")).render(e.jsx(s.StrictMode,{children:e.jsx(_,{})}));
